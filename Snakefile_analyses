IDS, = glob_wildcards("input/assembly/{sample}_genomic.fna")

rule assemble:
  input:
    R1 = "data/simulated_trimmed/{sample}_R1.fastq.gz",
    R2 = "data/simulated_trimmed/{sample}_R2.fastq.gz",
  output:
    contigs = "data/assembly/{sample}_contigs.fa
  #params:
  conda:
    "envs/skesa_env.yaml"
  message:
    "Running skesa on sample {sample}"
  shell:
  """
    skesa --reads {input.R1},{input.R2} > {output.contigs}
  """
  
rule mlst:
  input:
    rules.assemble.output.contigs
  output:
    "data/mlst/{sample}_mlst.txt"
  threads: 1
  params: None
  conda:
      "envs/mlst.yaml"
  message:
        "Running mlst on sample {}"
  shell:
    """
      mlst -q {input} > {output}
    """
    
    
rule amr: ### steal from https://github.com/pha4ge/hAMRonization_workflow/tree/master/rules
  input:
    rules.assemble.output.contigs
  output:
    "data/amr/{sample}_amr.txt"
  params: None
  conda:
    "envs/abricate.yaml"
#  message:
#    "Running XXX on sample {wildcard.sa}
  shell:
    """
    abricate -q  {input} > {output}
    """
  
